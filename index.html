<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Waar is Jeffrey?</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700;900&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{--bg:#0d0d0d;--gold:#c4a35a;--gold-light:#e8d5a3;--red:#cc3333;--text:#e8e0d0;--muted:#888}
body{background:var(--bg);color:var(--text);font-family:'Georgia',serif;overflow:hidden;height:100vh;width:100vw;-webkit-tap-highlight-color:transparent}
h1,h2,h3,.tf{font-family:'Playfair Display',serif}
a{color:var(--gold)}

body::after{content:'';position:fixed;inset:0;pointer-events:none;z-index:99999;
background-image:url("data:image/svg+xml,%3Csvg width='6' height='6' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.03'/%3E%3C/svg%3E");
opacity:0.3}

.screen{display:none;position:fixed;inset:0;z-index:1;flex-direction:column}
.screen.active{display:flex}

.btn{font-family:'Playfair Display',serif;background:transparent;color:var(--gold);border:2px solid var(--gold);
padding:0.9rem 2.2rem;font-size:1rem;cursor:pointer;letter-spacing:0.08em;transition:all 0.3s;text-transform:uppercase}
.btn:hover,.btn:active{background:var(--gold);color:var(--bg)}
.btn-s{padding:0.5rem 1rem;font-size:0.8rem}
.btn-gold{background:var(--gold);color:var(--bg)}
.btn:disabled{opacity:0.3;pointer-events:none}

#intro{align-items:center;justify-content:center;text-align:center;padding:2rem;
background:radial-gradient(ellipse at center,#1a1510 0%,var(--bg) 70%)}
.logo{font-size:clamp(2.5rem,8vw,4.5rem);color:var(--gold);letter-spacing:0.05em;margin-bottom:0.3rem;
text-shadow:0 0 60px rgba(196,163,90,0.25)}
.tagline{font-size:clamp(1rem,3vw,1.4rem);color:var(--gold-light);opacity:0.7;font-style:italic;margin-bottom:2.5rem}
.diff-row{display:flex;gap:0.8rem;margin-bottom:2rem;flex-wrap:wrap;justify-content:center}
.diff-btn{padding:0.5rem 1.2rem;font-size:0.85rem;border:1px solid var(--gold);background:transparent;
color:var(--gold);cursor:pointer;font-family:'Playfair Display',serif;transition:all 0.3s;opacity:0.5}
.diff-btn.sel{opacity:1;background:var(--gold);color:var(--bg)}
.disc{font-size:0.72rem;color:#555;max-width:420px;margin-top:2rem;line-height:1.6}

#game{background:var(--bg)}
#map{flex:1;background:var(--bg);z-index:1}
.leaflet-container{background:var(--bg)!important}
.leaflet-control-zoom{display:none}
.leaflet-tile{image-rendering:auto}

.hud{position:absolute;top:0;left:0;right:0;z-index:1000;display:flex;justify-content:space-between;
align-items:center;padding:0.7rem 1rem;background:linear-gradient(to bottom,rgba(13,13,13,0.92) 60%,transparent);pointer-events:none}
.hud>*{pointer-events:auto}
.hud-i{font-family:'Playfair Display',serif;color:var(--gold);font-size:1rem}
.hud-t{font-size:1.5rem;font-weight:700;min-width:2.5rem;text-align:center;transition:color 0.3s}
.hud-t.urg{color:var(--red);animation:pulse .5s infinite alternate}
@keyframes pulse{from{opacity:1}to{opacity:0.5}}

.bbar{position:absolute;bottom:0;left:0;right:0;z-index:1000;text-align:center;
padding:0.8rem 1rem 1.2rem;background:linear-gradient(to top,rgba(13,13,13,0.92) 60%,transparent);pointer-events:none}
.bbar>*{pointer-events:auto}
.ptitle{font-family:'Playfair Display',serif;font-size:clamp(0.85rem,2.5vw,1.2rem);color:var(--gold-light);margin-bottom:0.5rem}
.hrow{display:flex;gap:0.5rem;justify-content:center;align-items:center;flex-wrap:wrap}
.htxt{color:var(--gold-light);font-style:italic;font-size:0.9rem;max-width:400px}

.cr{position:fixed;width:40px;height:40px;border-radius:50%;transform:translate(-50%,-50%);pointer-events:none;z-index:2000}
.cr.miss{border:2px solid var(--red);background:rgba(200,40,40,0.15);animation:ro .5s forwards}
.cr.hit{border:3px solid var(--gold);background:rgba(196,163,90,0.2);animation:rg .8s forwards}
@keyframes ro{0%{opacity:1;transform:translate(-50%,-50%) scale(1)}100%{opacity:0;transform:translate(-50%,-50%) scale(2.5)}}
@keyframes rg{0%{opacity:1;transform:translate(-50%,-50%) scale(1)}60%{opacity:1;transform:translate(-50%,-50%) scale(2)}100%{opacity:0;transform:translate(-50%,-50%) scale(3)}}

.jm{width:60px;height:60px;border-radius:50%;border:3px solid var(--gold);
box-shadow:0 0 20px rgba(196,163,90,0.6),0 0 40px rgba(196,163,90,0.3);animation:fp 1.5s infinite}
@keyframes fp{0%,100%{transform:scale(1);opacity:1}50%{transform:scale(1.3);opacity:0.7}}

#reveal,#timeup{align-items:center;justify-content:center;text-align:center;padding:2rem;background:rgba(13,13,13,0.96)}
.rv-t{color:var(--gold);font-size:2rem;margin-bottom:0.5rem}
.rv-s{font-size:3.5rem;color:var(--gold-light);font-family:'Playfair Display',serif}
.rv-b{color:var(--muted);font-size:0.85rem;margin:0.5rem 0 1rem;line-height:1.8}
.rv-f{max-width:480px;line-height:1.7;color:#aaa;font-style:italic;margin-bottom:1.5rem;font-size:0.95rem}
.tu-t{color:var(--red);font-size:2rem;margin-bottom:1rem}

#end{align-items:center;justify-content:center;text-align:center;padding:2rem;
background:radial-gradient(ellipse at center,#1a1510 0%,var(--bg) 70%)}
.es{font-size:4.5rem;color:var(--gold-light);font-family:'Playfair Display',serif}
.el{color:var(--gold);font-size:1.2rem;margin-bottom:1rem}
.est{color:var(--muted);line-height:2;margin-bottom:2rem}
.er{color:var(--gold);font-size:1.3rem;margin-bottom:1.5rem}
.brow{display:flex;gap:0.8rem;flex-wrap:wrap;justify-content:center}

#about{align-items:center;padding:2rem;overflow-y:auto;background:var(--bg)}
#about .ct{max-width:600px;line-height:1.8;padding-top:3rem}
#about h2{color:var(--gold);margin:1.5rem 0 0.5rem}
#about p{color:#999;margin-bottom:1rem}
.bbk{position:fixed;top:1rem;right:1rem;z-index:100}

.fade-in{animation:fi .5s ease}
@keyframes fi{from{opacity:0}to{opacity:1}}

.fs-btn{position:absolute;top:0.7rem;right:0.7rem;z-index:1001;background:rgba(13,13,13,0.7);
border:1px solid var(--gold);color:var(--gold);width:36px;height:36px;border-radius:4px;
cursor:pointer;font-size:1.2rem;display:flex;align-items:center;justify-content:center}
.snd-btn{position:absolute;top:0.7rem;right:3.2rem;z-index:1001;background:rgba(13,13,13,0.7);
border:1px solid var(--gold);color:var(--gold);width:36px;height:36px;border-radius:4px;
cursor:pointer;font-size:1rem;display:flex;align-items:center;justify-content:center}
</style>
</head>
<body>

<div id="intro" class="screen active">
  <h1 class="logo tf">Waar is Jeffrey?</h1>
  <p class="tagline">Hij was overal. Kun jij hem vinden?</p>
  <div class="diff-row">
    <button class="diff-btn" onclick="setDiff('easy',this)">Makkelijk (60s)</button>
    <button class="diff-btn sel" onclick="setDiff('medium',this)">Medium (45s)</button>
    <button class="diff-btn" onclick="setDiff('hard',this)">Moeilijk (30s)</button>
  </div>
  <button class="btn btn-gold" onclick="startGame()">Begin de zoektocht</button>
  <p class="disc">Satirisch kunstproject. Alle schilderijen bewerkt met AI. <a href="#" onclick="show('about');return false">Meer info ‚Üí</a></p>
</div>

<div id="game" class="screen">
  <div class="hud">
    <div class="hud-i">‚≠ê <span id="hs">0</span></div>
    <div class="hud-i hud-t" id="ht">45</div>
    <div class="hud-i"><span id="hf">0</span>/<span id="htot">7</span></div>
  </div>
  <div id="map"></div>
  <div class="bbar">
    <div class="ptitle" id="pt"></div>
    <div class="hrow">
      <button class="btn btn-s" id="hb" onclick="useHint()">üí° Hint (-10s)</button>
      <span class="htxt" id="htx" style="display:none"></span>
    </div>
  </div>
  <button class="fs-btn" onclick="toggleFS()" title="Volledig scherm">‚õ∂</button>
  <button class="snd-btn" id="sb" onclick="toggleSound()">üîä</button>
</div>

<div id="reveal" class="screen">
  <h2 class="rv-t tf">Gevonden! üéâ</h2>
  <div class="rv-s" id="rs">+85</div>
  <div class="rv-b" id="rb"></div>
  <p class="rv-f" id="rf"></p>
  <button class="btn btn-gold" onclick="nextLevel()">Volgende schilderij ‚Üí</button>
</div>

<div id="timeup" class="screen">
  <h2 class="tu-t tf">‚è∞ Tijd is op!</h2>
  <p style="color:#aaa;margin-bottom:0.5rem" id="tut"></p>
  <p style="color:#666;font-style:italic;margin-bottom:1.5rem">Jeffrey blijft verborgen... voor nu.</p>
  <button class="btn" onclick="nextLevel()">Volgende schilderij ‚Üí</button>
</div>

<div id="end" class="screen">
  <h2 class="tf" style="color:var(--gold);font-size:2rem;margin-bottom:0.5rem">Zoektocht Voltooid</h2>
  <div class="es" id="esc">0</div>
  <div class="el">punten</div>
  <div class="er" id="erk"></div>
  <div class="est" id="ess"></div>
  <div class="brow">
    <button class="btn" onclick="shareScore()">üì§ Deel score</button>
    <button class="btn btn-gold" onclick="location.reload()">üîÑ Opnieuw</button>
  </div>
</div>

<div id="about" class="screen">
  <button class="btn btn-s bbk" onclick="show('intro')">‚Üê Terug</button>
  <div class="ct">
    <h2>Over dit project</h2>
    <p><strong>"Waar is Jeffrey?"</strong> is een satirisch digitaal kunstproject dat de alomtegenwoordigheid van Jeffrey Epstein in machtkringen visualiseert.</p>
    <h2>Bronvermelding</h2>
    <p>üñº De Oranjes ‚Äî Priv√©collectie<br>üñº De Nachtwacht ‚Äî Rembrandt, 1642 (Rijksmuseum)<br>üñº Kroningsbanket George IV ‚Äî George Jones, 1821<br>üñº School van Athene ‚Äî Raphael, 1511<br>üñº Boerenbruiloft ‚Äî Bruegel, 1567<br>üñº Het Laatste Avondmaal ‚Äî Da Vinci, 1498<br>üñº Bar bij de Folies-Berg√®re ‚Äî Manet, 1882</p>
    <h2>Disclaimer</h2>
    <p>Satirisch kunstproject. Bewerkt met AI (Krea). Geen origineel kunstwerk beschadigd.</p>
  </div>
</div>

<script>
const LEVELS = [
  {id:"oranjes",w:2400,h:1792,maxZ:4,title:"De Oranjes ‚Äî Koninklijke Familie, 2020s",jx:.85,jy:.32,r:.045,hint:"Zoek rechts boven, tussen de gasten...",hint2:"Hij staat bijna achter de groep...",fact:"Epstein bezocht Europa regelmatig en had connecties met meerdere Europese koninklijke families.",diff:"easy"},
  {id:"nachtwacht",w:4800,h:3584,maxZ:5,title:"De Nachtwacht ‚Äî Rembrandt, 1642",jx:.82,jy:.42,r:.04,hint:"Zoek in de schaduwen, rechts...",hint2:"Tussen de schutters, half verborgen...",fact:"De Nachtwacht hangt in het Rijksmuseum ‚Äî een museum dat Epstein meerdere keren bezocht.",diff:"medium"},
  {id:"banquet",w:5504,h:3072,maxZ:5,title:"Kroningsbanket George IV ‚Äî George Jones, 1821",jx:.35,jy:.70,r:.035,hint:"Zoek bij de banktafels, links van het midden...",hint2:"Hij zit aan tafel, kijkt naar het podium...",fact:"Prins Andrew bezocht Epstein's eiland meerdere keren.",diff:"medium"},
  {id:"athens",w:4800,h:3584,maxZ:5,title:"School van Athene ‚Äî Raphael, 1511",jx:.08,jy:.55,r:.035,hint:"Zoek links, bij de bogen...",hint2:"Hij leunt tegen een pilaar, observerend...",fact:"Epstein omringde zich met intellectuelen ‚Äî Stephen Hawking, Noam Chomsky, en talloze anderen.",diff:"hard"},
  {id:"wedding",w:4800,h:3584,maxZ:5,title:"Boerenbruiloft ‚Äî Bruegel, 1567",jx:.75,jy:.40,r:.04,hint:"Zoek rechts, aan het einde van de tafel...",hint2:"Hij zit te eten, past bijna in het gezelschap...",fact:"Bruegel schilderde het gewone volk, maar Epstein bewoog zich in de hoogste kringen.",diff:"hard"},
  {id:"supper",w:5504,h:3072,maxZ:5,title:"Het Laatste Avondmaal ‚Äî Da Vinci, 1498",jx:.92,jy:.40,r:.035,hint:"Zoek helemaal rechts, in de schaduw...",hint2:"Hij zit aan het uiteinde, als een ongenode gast...",fact:"Zoals Judas aan de tafel zat, zo zat Epstein bij de machtigen ‚Äî verborgen in het volle zicht.",diff:"expert"},
  {id:"bar",w:4800,h:3584,maxZ:5,title:"Bar bij de Folies-Berg√®re ‚Äî Manet, 1882",jx:.65,jy:.25,r:.04,hint:"Zoek in de spiegelreflectie, bovenaan...",hint2:"Zijn gezicht verschijnt in de spiegel achter de bar...",fact:"Manet schilderde de Parijse elite ‚Äî precies het milieu waar Epstein zich thuis voelde.",diff:"medium"}
];

const TIMERS={easy:60,medium:45,hard:30};
let S={diff:'medium',level:0,score:0,found:0,timer:45,interval:null,hintsUsed:0,misses:0,active:false,startTime:0,map:null,soundOn:true};

// Audio
let actx=null;
function ac(){if(!actx)actx=new(window.AudioContext||window.webkitAudioContext)();return actx}
function sndTick(){if(!S.soundOn)return;try{const c=ac(),o=c.createOscillator(),g=c.createGain();o.type='sine';o.frequency.value=800;g.gain.setValueAtTime(.08,c.currentTime);g.gain.exponentialRampToValueAtTime(.001,c.currentTime+.05);o.connect(g);g.connect(c.destination);o.start();o.stop(c.currentTime+.05)}catch(e){}}
function sndMiss(){if(!S.soundOn)return;try{const c=ac(),o=c.createOscillator(),g=c.createGain();o.type='sawtooth';o.frequency.value=200;o.frequency.exponentialRampToValueAtTime(100,c.currentTime+.15);g.gain.setValueAtTime(.12,c.currentTime);g.gain.exponentialRampToValueAtTime(.001,c.currentTime+.15);o.connect(g);g.connect(c.destination);o.start();o.stop(c.currentTime+.15)}catch(e){}}
function sndHit(){if(!S.soundOn)return;try{const c=ac();[523,659,784].forEach((f,i)=>{const o=c.createOscillator(),g=c.createGain();o.type='sine';o.frequency.value=f;g.gain.setValueAtTime(.15,c.currentTime+i*.1);g.gain.exponentialRampToValueAtTime(.001,c.currentTime+i*.1+.3);o.connect(g);g.connect(c.destination);o.start(c.currentTime+i*.1);o.stop(c.currentTime+i*.1+.3)})}catch(e){}}
function sndUrg(){if(!S.soundOn)return;try{const c=ac(),o=c.createOscillator(),g=c.createGain();o.type='square';o.frequency.value=1000;g.gain.setValueAtTime(.06,c.currentTime);g.gain.exponentialRampToValueAtTime(.001,c.currentTime+.08);o.connect(g);g.connect(c.destination);o.start();o.stop(c.currentTime+.08)}catch(e){}}
function toggleSound(){S.soundOn=!S.soundOn;document.getElementById('sb').textContent=S.soundOn?'üîä':'üîá'}

function show(id){document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));const el=document.getElementById(id);el.classList.add('active','fade-in');setTimeout(()=>el.classList.remove('fade-in'),500)}
function setDiff(d,b){S.diff=d;document.querySelectorAll('.diff-btn').forEach(b=>b.classList.remove('sel'));b.classList.add('sel')}
function toggleFS(){if(document.fullscreenElement)document.exitFullscreen?.();else document.documentElement.requestFullscreen?.()}

function startGame(){
  S.level=0;S.score=0;S.found=0;
  document.getElementById('hs').textContent='0';
  document.getElementById('hf').textContent='0';
  document.getElementById('htot').textContent=LEVELS.length;
  try{ac().resume()}catch(e){}
  loadLevel();
}

function loadLevel(){
  const lv=LEVELS[S.level];
  if(!lv){endGame();return}
  show('game');
  S.hintsUsed=0;S.misses=0;S.active=false;

  const hb=document.getElementById('hb');
  hb.textContent='üí° Hint (-10s)';hb.disabled=false;hb.style.display='';
  document.getElementById('htx').style.display='none';
  document.getElementById('htx').textContent='';
  document.getElementById('pt').textContent=lv.title;

  if(S.map){S.map.remove();S.map=null}

  // Use a simple image overlay approach with Leaflet
  // CRS.Simple: coordinates are [y, x] where y increases upward
  // We'll place the image from [0,0] (bottom-left) to [h, w] (top-right)
  const bounds = [[0, 0], [lv.h, lv.w]];
  
  S.map = L.map('map', {
    crs: L.CRS.Simple,
    minZoom: -3,  // allow zooming out enough to see whole image
    maxZoom: 4,   // allow zooming in for detail
    zoomSnap: 0.25,
    zoomDelta: 0.5,
    attributionControl: false,
    zoomControl: false,
    maxBounds: L.latLngBounds([0,0],[lv.h,lv.w]).pad(0.1),
    maxBoundsViscosity: 0.8
  });

  // Use a single full image instead of tiles - more reliable
  // The 4K images are served as the edited JPGs
  const imgUrl = `images/edited/${getFilename(lv.id)}`;
  L.imageOverlay(imgUrl, bounds).addTo(S.map);
  S.map.fitBounds(bounds);

  S.map.on('click', onMapClick);

  setTimeout(()=>{
    S.active=true;
    S.startTime=Date.now();
    startTimer();
  },500);
}

function getFilename(id) {
  const map = {
    oranjes: 'oranjes_4k.png',
    nachtwacht: 'night_watch_4k.png',
    banquet: 'george_iv_banquet_4k.png',
    athens: 'school_athens_4k.png',
    wedding: 'peasant_wedding_4k.png',
    supper: 'last_supper_4k.png',
    bar: 'bar_folies_4k.png'
  };
  return map[id];
}

function onMapClick(e){
  if(!S.active)return;
  const lv=LEVELS[S.level];
  // CRS.Simple: latlng.lat = y from bottom, latlng.lng = x from left
  const clickX = e.latlng.lng / lv.w;
  const clickY = 1 - (e.latlng.lat / lv.h);  // convert to top-down percentage

  const dx=clickX-lv.jx, dy=clickY-lv.jy;
  const dist=Math.sqrt(dx*dx+dy*dy);
  const pt=S.map.latLngToContainerPoint(e.latlng);
  const mapRect=document.getElementById('map').getBoundingClientRect();

  if(dist<=lv.r) hitJeffrey(e.latlng,pt,mapRect);
  else missClick(pt,mapRect);
}

function missClick(pt,mr){
  S.misses++;S.timer=Math.max(1,S.timer-3);updateTimer();sndMiss();
  try{navigator.vibrate?.(50)}catch(e){}
  const r=document.createElement('div');r.className='cr miss';
  r.style.left=(mr.left+pt.x)+'px';r.style.top=(mr.top+pt.y)+'px';
  document.body.appendChild(r);setTimeout(()=>r.remove(),500);
}

function hitJeffrey(ll,pt,mr){
  S.active=false;clearInterval(S.interval);sndHit();
  try{navigator.vibrate?.(200)}catch(e){}

  const r=document.createElement('div');r.className='cr hit';
  r.style.left=(mr.left+pt.x)+'px';r.style.top=(mr.top+pt.y)+'px';
  document.body.appendChild(r);setTimeout(()=>r.remove(),800);

  const lv=LEVELS[S.level];
  const icon=L.divIcon({className:'jm',iconSize:[60,60],iconAnchor:[30,30]});
  L.marker(ll,{icon}).addTo(S.map);

  // Zoom in to Jeffrey
  const targetZoom = Math.min(3, S.map.getZoom()+2);
  S.map.flyTo(ll, targetZoom, {duration:1});

  const elapsed=(Date.now()-S.startTime)/1000;
  const tb=Math.max(0,Math.round(100-elapsed*2));
  const hp=S.hintsUsed*-15, mp=S.misses*-5, nh=S.hintsUsed===0?10:0;
  const sc=Math.max(5,tb+hp+mp+nh);
  S.score+=sc;S.found++;
  document.getElementById('hs').textContent=S.score;
  document.getElementById('hf').textContent=S.found;

  setTimeout(()=>{
    document.getElementById('rs').textContent='+'+sc;
    let b=`‚è± ${elapsed.toFixed(1)}s ‚Äî tijdbonus: ${tb}`;
    if(S.hintsUsed>0)b+=` | hints: ${hp}`;
    if(S.misses>0)b+=` | foute klikken: ${mp}`;
    if(nh)b+=` | geen hint bonus: +10`;
    document.getElementById('rb').textContent=b;
    document.getElementById('rf').textContent='üí° '+lv.fact;
    show('reveal');
  },1800);
}

function useHint(){
  if(!S.active)return;
  const lv=LEVELS[S.level];
  S.hintsUsed++;
  if(S.hintsUsed===1){
    S.timer=Math.max(1,S.timer-10);updateTimer();
    document.getElementById('htx').textContent=lv.hint;
    document.getElementById('htx').style.display='';
    document.getElementById('hb').textContent='üí° Hint 2 (-10s)';
  } else if(S.hintsUsed===2){
    S.timer=Math.max(1,S.timer-10);updateTimer();
    document.getElementById('htx').textContent=lv.hint2;
    document.getElementById('hb').disabled=true;
    document.getElementById('hb').textContent='üí° Geen hints meer';
    // Pan toward Jeffrey (with slight random offset)
    const jLat=lv.h*(1-lv.jy), jLng=lv.w*lv.jx;
    const off=lv.w*0.06;
    S.map.flyTo(L.latLng(jLat+off*(Math.random()-.5),jLng+off*(Math.random()-.5)),Math.max(1,S.map.getZoom()+1),{duration:1.5});
  }
}

function nextLevel(){S.level++;loadLevel()}

function startTimer(){
  S.timer=TIMERS[S.diff];updateTimer();
  clearInterval(S.interval);
  S.interval=setInterval(()=>{
    if(!S.active)return;
    S.timer--;updateTimer();
    if(S.timer<=10&&S.timer>0)sndUrg();
    else if(S.timer>0)sndTick();
    if(S.timer<=0){
      clearInterval(S.interval);S.active=false;
      document.getElementById('tut').textContent=LEVELS[S.level].title;
      show('timeup');
    }
  },1000);
}

function updateTimer(){
  const el=document.getElementById('ht');
  el.textContent=Math.max(0,S.timer);
  el.classList.toggle('urg',S.timer<=10);
}

function endGame(){
  clearInterval(S.interval);
  if(S.map){S.map.remove();S.map=null}
  document.getElementById('esc').textContent=S.score;
  let rk;
  if(S.found===LEVELS.length&&S.score>500)rk='üèÜ Meesterdetective!';
  else if(S.found>=5)rk='üîç Scherp oog!';
  else if(S.found>=3)rk='üëÄ Je komt in de buurt...';
  else rk='ü´£ Jeffrey blijft ongrijpbaar';
  document.getElementById('erk').textContent=rk;
  document.getElementById('ess').innerHTML=`Schilderijen: ${S.found}/${LEVELS.length}<br>Moeilijkheid: ${S.diff}`;
  show('end');
}

function shareScore(){
  const t=`üîç Waar is Jeffrey?\n${S.score} punten ‚Äî ${S.found}/${LEVELS.length} schilderijen\nKun jij hem vinden?`;
  if(navigator.share)navigator.share({title:'Waar is Jeffrey?',text:t});
  else if(navigator.clipboard){navigator.clipboard.writeText(t);alert('Score gekopieerd!')}
}
</script>
</body>
</html>
